---
description: Go 1.16 e 1.17 - Era do lazy loading e mÃ³dulos obrigatÃ³rios
---

# Go 1.16-1.17: A era do lazy loading

## VisÃ£o geral

As versÃµes Go 1.16 e 1.17 marcam um **divisor de Ã¡guas** no ecossistema Go, tornando mÃ³dulos **obrigatÃ³rios** e introduzindo otimizaÃ§Ãµes revolucionÃ¡rias de performance.

**Timeline**:
- **Go 1.16**: Fevereiro 2021
- **Go 1.17**: Agosto 2021

---

## Go 1.16 (Fevereiro 2021)

### ğŸ¯ MudanÃ§a mais importante: mÃ³dulos agora sÃ£o obrigatÃ³rios

```bash
# GO111MODULE agora ON por padrÃ£o
# GOPATH mode descontinuado para novos projetos
GO111MODULE=on  # PadrÃ£o (nÃ£o precisa mais definir!)
```

**Impacto**:
- Todos os novos projetos **devem** ter `go.mod`
- GOPATH ainda funciona para projetos legados
- MigraÃ§Ã£o para mÃ³dulos se tornou urgente

### ğŸ”„ Comandos de Build NÃ£o Modificam go.mod

**MudanÃ§a de comportamento**:

```bash
# Go â‰¤ 1.15
go build  # Modifica go.mod automaticamente âœï¸

# Go â‰¥ 1.16
go build  # NÃƒO modifica go.mod âŒ
go test   # NÃƒO modifica go.mod âŒ
go run    # NÃƒO modifica go.mod âŒ
```

**Como adicionar dependÃªncias agora**:
```bash
# Use explicitamente
go get <package>@<version>
go mod tidy
```

### ğŸ“¦ go install com VersÃµes

Novo: instalar programas em versÃµes especÃ­ficas:

```bash
# Antes (Go 1.15)
GO111MODULE=on go get github.com/golangci/golangci-lint/cmd/golangci-lint@v1.43.0

# Agora (Go 1.16+)
go install github.com/golangci/golangci-lint/cmd/golangci-lint@v1.43.0

# Instala em $GOPATH/bin ou $GOBIN
```

**BenefÃ­cios**:
- NÃ£o polu `go.mod` do projeto
- VersÃµes explÃ­citas
- Isolamento de ferramentas

### ğŸš« Module Retraction

Marque versÃµes problemÃ¡ticas como nÃ£o recomendadas:

```go
// go.mod
retract (
    v1.5.0 // Bug crÃ­tico - use v1.5.1+
    [v1.2.0, v1.2.3] // Builds quebradas
)
```

Ver capÃ­tulo: [Module Retraction](../avancado/module-retraction.md)

### ğŸ”’ GOVCS - Controle de VCS

ProteÃ§Ã£o contra comandos maliciosos:

```bash
# PadrÃ£o seguro
GOVCS="public:git|hg,private:all"

# Apenas Git
GOVCS="*:git"
```

### ğŸ“ PadrÃ£o "all" redefinido

```bash
# Go â‰¤ 1.15
go test all  # Testa TUDO, incluindo deps transitivas

# Go â‰¥ 1.16
go test all  # Testa apenas main module + deps diretas
```

### ğŸ—‚ï¸ Embed package

Embute arquivos no binÃ¡rio (nÃ£o Ã© de mÃ³dulos, mas importante):

```go
import _ "embed"

//go:embed config.yaml
var configData []byte

//go:embed static/*
var staticFiles embed.FS
```

### Outras melhorias

- **GOMODCACHE** separado de GOPATH
- Melhorias no vendor
- `go mod download` mais robusto
- Performance geral melhorada

---

## Go 1.17 (Agosto 2021)

### ğŸš€ Lazy Module Loading

**RevoluÃ§Ã£o de Performance!**

**Como funciona**:
- Carrega grafo de mÃ³dulos **sob demanda**
- NÃ£o carrega tudo upfront
- Builds muito mais rÃ¡pidos

**Resultados**:
- âš¡ 50% mais rÃ¡pido em projetos grandes
- ğŸ’¾ Menor consumo de memÃ³ria
- ğŸ“‰ go.sum 50% menor

Ver capÃ­tulo: [Lazy Loading](../avancado/lazy-loading.md)

### âœ‚ï¸ Module Graph Pruning

**Poda do Grafo de DependÃªncias**:

```
Go 1.16:
Seu mÃ³dulo
  â””â”€ Dep A
      â””â”€ Dep B
          â””â”€ Dep C  â† Carrega TUDO

Go 1.17+:
Seu mÃ³dulo
  â””â”€ Dep A
      â””â”€ Dep B  â† Para aqui (pruning)
```

**BenefÃ­cios**:
- Menos dependÃªncias processadas
- Menos conflitos
- Grafo mais limpo

### ğŸ“‹ Dois blocos de require

Agora `go.mod` separa deps diretas e indiretas:

```go
module example.com/projeto

go 1.17

// DependÃªncias DIRETAS
require (
    github.com/gin-gonic/gin v1.9.1
    gorm.io/gorm v1.25.7
)

// DependÃªncias INDIRETAS
require (
    github.com/gin-contrib/sse v0.1.0 // indirect
    github.com/go-playground/validator/v10 v10.14.0 // indirect
)
```

**Vantagens**:
- Clara distinÃ§Ã£o
- FÃ¡cil ver o que vocÃª realmente usa
- Melhor legibilidade

### ğŸ”¢ DependÃªncias transitivas explÃ­citas

Go 1.17+ lista **todas** as deps transitivas:

```bash
# Go 1.16: go.mod tinha ~10 linhas
# Go 1.17+: go.mod pode ter ~100 linhas

# MAS grafo Ã© podado, entÃ£o builds sÃ£o mais rÃ¡pidos!
```

### ğŸ“Š `go mod graph` melhorado

```bash
# Ver grafo podado
go mod graph

# Muito menor que antes!
```

### ğŸ› ï¸ MudanÃ§as no `go get` 

```bash
# Deprecado em comandos de build
go get -d  # Flag -d Ã© padrÃ£o e deprecada

# Use go install para ferramentas
go install github.com/tool@latest
```

### Outras melhorias

- `go run` aceita mÃºltiplos arquivos
- Melhorias no `go mod vendor`
- Performance de compilaÃ§Ã£o melhorada
- Suporte a novas arquiteturas (ARM64)

---

## Migrando de 1.15 â†’ 1.16 â†’ 1.17

### Passo 1: Atualizar para 1.16

```bash
# 1. Baixar Go 1.16
# 2. Atualizar go.mod
go mod edit -go=1.16

# 3. Mudar workflow
# ANTES: go build modificava go.mod
# AGORA: Use go mod tidy

go mod tidy
go build ./...
```

### Passo 2: Atualizar para 1.17

```bash
# 1. Baixar Go 1.17
# 2. Atualizar go.mod
go mod edit -go=1.17

# 3. Reorganizar requires
go mod tidy -go=1.17

# 4. go.mod agora tem dois blocos!
# 5. go.sum serÃ¡ muito menor
```

### Verificar mudanÃ§as

```bash
# Ver diff do go.mod
git diff go.mod

# Ver diff do go.sum (serÃ¡ grande!)
git diff go.sum | head -50
```

---

## Checklist de atualizaÃ§Ã£o

### Para Go 1.16

- [ ] Atualizar `go` line para `1.16`
- [ ] Remover variÃ¡vel `GO111MODULE` (nÃ£o mais necessÃ¡ria)
- [ ] Atualizar scripts que dependem de build modificando go.mod
- [ ] Mudar `go get` para `go install` para ferramentas
- [ ] Adicionar `retract` para versÃµes problemÃ¡ticas
- [ ] Configurar `GOVCS` se necessÃ¡rio
- [ ] Testar com o novo padrÃ£o "all"

### Para Go 1.17

- [ ] Atualizar `go` line para `1.17`
- [ ] Executar `go mod tidy -go=1.17`
- [ ] Verificar que go.mod tem dois blocos
- [ ] Confirmar que go.sum reduziu de tamanho
- [ ] Atualizar deps para Go 1.17+ (para mÃ¡ximo pruning)
- [ ] Medir performance (deve ser mais rÃ¡pido!)
- [ ] Atualizar CI/CD se necessÃ¡rio

---

## Recursos adicionais

- [Go 1.16 Release Notes](https://go.dev/doc/go1.16)
- [Go 1.17 Release Notes](https://go.dev/doc/go1.17)
- [Module Graph Pruning](https://go.dev/ref/mod#graph-pruning)
- [Retract Directive](https://go.dev/ref/mod#go-mod-file-retract)

---

## Resumo: Por que essas versÃµes sÃ£o importantes?

| Feature | Impacto |
|---------|---------|
| **MÃ³dulos obrigatÃ³rios** (1.16) | ğŸ¯ Fim da era GOPATH |
| **Build nÃ£o modifica go.mod** (1.16) | ğŸ”’ Builds determinÃ­sticos |
| **go install @version** (1.16) | ğŸ› ï¸ Ferramentas versionadas |
| **Retraction** (1.16) | ğŸš« Marcar versÃµes ruins |
| **Lazy loading** (1.17) | âš¡ 50% mais rÃ¡pido |
| **Graph pruning** (1.17) | âœ‚ï¸ Menos conflitos |
| **Dois blocos require** (1.17) | ğŸ“‹ Mais legÃ­vel |

{% hint style="success" %}
**Go 1.16-1.17 sÃ£o as versÃµes que tornaram o sistema de mÃ³dulos maduro e production-ready para todos os casos de uso.**
{% endhint %}
